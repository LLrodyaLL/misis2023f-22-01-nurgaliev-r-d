### СУБД - «ключ-значение» (key-value store)

## **Введение**

База данных «key-value» – это тип, относящийся к семейству нереляционных баз данных NoSQL, в которой для хранения данных используется простой метод «ключ значение». Это дает возможность хранить данные как совокупность пар «ключ значение», в которых ключ служит уникальным идентификатором. 

Ключи и значения фиксируются в виде простой или составной информации. 

Эти хранилища максимально быстро реагируют на запросы информации и прекрасно масштабируются.

В хранилищах «ключ-значение» нет языка запросов, но они предоставляют возможность добавлять и удалять пары «ключ-значение». 

Значения не могут быть запрошены или найдены. Запросить можно только ключ.
![Image alt](https://github.com/LLrodyaLL/misis2023f-22-01-nurgaliev-r-d/raw/main/docs/KV.png)

## **Методы хранения**

- **Хеш-таблицы:** Многие реализации баз данных "ключ-значение" используют хеш-таблицы для хранения данных. Ключи хешируются, и полученный хеш используется для быстрого поиска соответствующего значения. Это обеспечивает константное время доступа в среднем случае.

![Image alt](https://github.com/LLrodyaLL/misis2023f-22-01-nurgaliev-r-d/raw/main/docs/hash.jpg)

- **B-деревья:** Некоторые системы используют B-деревья для управления данными. Данные организованы в виде дерева, где каждый узел содержит набор ключей и указатели на дочерние узлы. Это обеспечивает эффективное управление упорядоченными данными и быстрый поиск.

![Image alt](https://github.com/LLrodyaLL/misis2023f-22-01-nurgaliev-r-d/raw/main/docs/b-tree.jpg)

## **Преимущества**

- Не требуется нормализация.
- Базам данных «ключ-значение» нет необходимости выполнять ресурсоемкое объединение таблиц. Их гибкость позволяет разместить всю необходимую информацию в одной таблице.
- Поскольку между записями в БД «ключ-значение» нет жёсткой связи, данные можно дробить и хранить на нескольких независимых серверах. Горизонтальное масштабирование легче и дешевле, чем вертикальное.
- Быстрый доступ к данным.
- Расширенные базы данных «ключ-значение» обеспечивают встроенную поддержку принципа ACID на стороне сервера. Благодаря этому разработчики могут удобно и без ошибок вносить изменения в большое число элементов в пределах одной или нескольких таблиц.
- Многие хранилища «ключ-значение» предлагают встроенную поддержку репликации путем автоматического копирования данных между несколькими узлами хранения. Это помогает автоматически восстанавливать данные – в случае сбоя сервера данные останутся в вашем распоряжении.
- В хранилищах «ключ-значение» можно сортировать ключи, чтобы систематизировать данные и разбивать их на разделы. Например, ключи можно отсортировать следующими образами:
  - В алфавитном или цифровом порядке.
  - Хронологически.
  - По размеру данных.

## **Недостатки**

- Отсутствие Языка Запросов, что может усложнить выполнение более сложных операций.

## **Варианты применения**

1. **Рекомендации по продуктам и персонализированные списки**

В БД будет храниться уникальный номер клиента и набор продуктов, которые он чаще всего покупает.
   - СУБД «ключ-значение» обеспечивает быстрый и эффективный способ хранения и извлечения пользовательских данных, которые можно использовать для персонализации рекомендаций и списков продуктов.
   - Это может привести к повышению удовлетворенности пользователей и потенциально увеличению доходов бизнеса.
   - **Преимущества:** Масштабируемость, быстрый доступ к данным.
   - **Недостаток:** Невозможность составления сложного запроса для установления зависимостей.

2. **Разработка кэширующей C++ библиотеки для хранения результатов вычислений**

Библиотека должна поддерживать кэширование результатов функций и обеспечивать быстрый доступ к ним. При каждом вызове функции библиотеки вы можете проверять, есть ли соответствующий результат в кэше по ключу. Если результат найден, он возвращается немедленно, иначе выполняется вычисление и результат сохраняется в кэш.
   - Возможно управлять временем жизни кэша, удалять устаревшие записи, поддерживать актуальность кэша.
   - **Преимущества:** Быстрый доступ к результатам, масштабируемость, управление памятью, можно отсортировать ключи.

3. **Разработка многопользовательского онлайн-чата с помощью C++**

Необходимо эффективно хранить сообщения пользователей, идентифицированных их уникальными именами.
   - Ключом будет выступать имя пользователя, а также дата и время отправки сообщения, значением будет выступать сам текст сообщения. Тем самым можно будет однозначно по ключу определить уникальное сообщение.
   - **Преимущества:** Масштабируемость, возможность репликации и последующего восстановления сообщений при их утере.
   - **Недостатки:** Невозможность составления сложного запроса, например, для поиска сообщений по определенным дням.
![Image alt](https://github.com/LLrodyaLL/misis2023f-22-01-nurgaliev-r-d/raw/main/docs/messages.jpg)

## **Примеры СУБД key-value**

1. Redis
2. Amazon DynamoDB

## **Управление**

- Не поддерживают сложные запросы, поэтому в основном используются простые термины, такие как `get`, `set` и `delete`.
- Пример для Redis:
```c++
#include <cpp_redis/cpp_redis>
#include <iostream>

int main() {
    cpp_redis::client client("localhost", 6379);

    // Чтение данных
    auto reply = client.get("ключ");
    if (reply.is_string()) {
        std::cout << "Значение: " << reply.as_string() << std::endl;
    }

    // Запись данных (put, аналог set)
    client.set("ключ", "значение");

    // Удаление данных
    client.del("ключ");

    return 0;
}
```

## **Источники**

- AWS, “What Is a Key-Value Database?”
[https://aws.amazon.com/ru/nosql/key-value/](https://aws.amazon.com/ru/nosql/key-value/)
- Yandex Cloud, “NoSQL: виды, особенности и применение”
[https://cloud.yandex.ru/ru/blog/posts/2022/10/nosql](https://cloud.yandex.ru/ru/blog/posts/2022/10/nosql)
- Redis, “What is a key-value Database?”
[https://redis.com/nosql/key-value-databases/](https://redis.com/nosql/key-value-databases/)
